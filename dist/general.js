!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.General=e():r.General=e()}(this,function(){return function(r){function e(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return r[t].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=r,e.c=n,e.i=function(r){return r},e.d=function(r,n,t){e.o(r,n)||Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:t})},e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,"a",n),n},e.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},e.p="/dist/",e(e.s=1)}([function(r,e,n){"use strict";var t=n(2);n.d(e,"a",function(){return i});var o=n(4),i=function(){function r(){var r=this;this.worker=new o,this.queue=[],this.currentJob=void 0,this.markerArray=new Float32Array(1e3*t.a),this.worker.onmessage=function(e){if(void 0!==r.currentJob){var n=r.currentJob,t=n.markers,o=n.resolve;r.recordResult(t,e.data),r.markerArray=e.data,r.currentJob=void 0,r.dequeue(),o()}}}return r.prototype.generalize=function(r,e,n,t,o){var i=this,u={bounds:r,pixelRatio:e,priorityGroups:n,markerCount:o.length,sprites:t.sprites,markers:this.pack(o)};return new Promise(function(r){i.queue.push({message:u,markers:o,resolve:r}),i.dequeue()})},r.prototype.clear=function(){this.queue=[]},r.prototype.pack=function(r){r.length*t.a>this.markerArray.length&&(this.markerArray=new Float32Array(r.length*t.a));for(var e=this.markerArray,n=0,o=0;n<r.length;n++,o+=t.a){var i=r[n],u=i.iconIndex,a=i.prevGroupIndex;this.markerArray[o+t.b.pixelPositionX]=i.pixelPosition[0],this.markerArray[o+t.b.pixelPositionY]=i.pixelPosition[1],e[o+t.b.groupIndex]=i.groupIndex,e[o+t.b.iconIndex]=void 0!==u?u:NaN,e[o+t.b.prevGroupIndex]=void 0!==a?a:NaN}return e},r.prototype.dequeue=function(){if(void 0===this.currentJob){var r=this.queue.shift();if(void 0!==r){var e=r.message;this.worker.postMessage(e,[e.markers.buffer]),this.currentJob=r}}},r.prototype.recordResult=function(r,e){for(var n=0,o=0;n<r.length;n++,o+=t.a){var i=e[o+t.b.iconIndex],u=e[o+t.b.prevGroupIndex];r[n].iconIndex=i!==i?void 0:i,r[n].prevGroupIndex=u!==u?void 0:u}},r}()},function(r,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=n(0);n.d(e,"General",function(){return t.a})},function(r,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i});var t=["pixelPositionX","pixelPositionY","groupIndex","iconIndex","prevGroupIndex"],o=t.length,i=t.reduce(function(r,e,n){return r[e]=n,r},{})},function(r,e){var n=window.URL||window.webkitURL;r.exports=function(r,e){try{try{var t;try{t=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder),t.append(r),t=t.getBlob()}catch(e){t=new Blob([r])}return new Worker(n.createObjectURL(t))}catch(e){return new Worker("data:application/javascript,"+encodeURIComponent(r))}}catch(r){if(!e)throw Error("Inline worker is not supported");return new Worker(e)}}},function(r,e,n){r.exports=function(){return n(3)('!function(n){function r(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return n[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var e={};r.m=n,r.c=e,r.i=function(n){return n},r.d=function(n,e,i){r.o(n,e)||Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:i})},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},r.p="/dist/",r(r.s=1)}([function(n,r,e){"use strict";e.d(r,"a",function(){return o}),e.d(r,"b",function(){return t});var i=["pixelPositionX","pixelPositionY","groupIndex","iconIndex","prevGroupIndex"],o=i.length,t=i.reduce(function(n,r,e){return n[r]=e,n},{})},function(n,r,e){"use strict";function i(n,r,e){for(var i=e.minX,o=e.minY,t=e.maxX,a=e.maxY,u=o;u<a;u++){var x=u*r+i>>3,m=u*r+t>>3,f=0;if(x===m)f=n[x]&255>>(7&i)&255<<8-(7&t);else{f=n[x]&255>>(7&i);for(var s=x+1;s<m;s++)f=n[s]|f;f=n[m]&255<<8-(7&t)|f}if(0!==f)return!0}return!1}function o(n,r,e){for(var i=e.minX,o=e.minY,t=e.maxX,a=e.maxY,u=o;u<a;u++){var x=u*r+i>>3,m=u*r+t>>3;if(x===m)n[x]=n[x]|255>>(7&i)&255<<8-(7&t);else{n[x]=n[x]|255>>(7&i);for(var f=x+1;f<m;f++)n[f]=255;n[m]=n[m]|255<<8-(7&t)}}}function t(n){return n!==n}function a(n){return n.minX===n.maxX||n.minY===n.maxY}function u(n,r,e,i,o,t,a,u,x,m){var f=i/a,s=u*i-o[0]*f*t[0]-m|0,c=x*i-o[1]*f*t[1]-m|0,p=u*i+o[0]*f*(1-t[0])+m|0,d=x*i+o[1]*f*(1-t[1])+m|0;n.minX=s>0?s<r?s:r:0,n.minY=c>0?c<e?c:e:0,n.maxX=p>0?p<r?p:r:0,n.maxY=d>0?d<e?d:e:0}Object.defineProperty(r,"__esModule",{value:!0});var x=e(0),m={minX:0,minY:0,maxX:0,maxY:0},f={minX:0,minY:0,maxX:0,maxY:0},s={minX:0,minY:0,maxX:0,maxY:0};onmessage=function(n){for(var r=n.data,e=r.bounds,c=r.pixelRatio,p=r.priorityGroups,d=r.sprites,v=r.markers,l=r.markerCount,X=1+(e.maxX-e.minX>>3)<<3,Y=e.maxY-e.minY,b=X*Y+8>>3,g=new Uint8Array(b),y=new Uint8Array(b),I=new Uint8Array(b),P=0;P<l;P++){var h=v[P*x.a+x.b.prevGroupIndex],G=v[P*x.a+x.b.pixelPositionX],w=v[P*x.a+x.b.pixelPositionY];if(!t(h)){var O=p[h],_=O.iconIndex,j=O.margin,A=O.degradation,M=d[_];if(!M)continue;var U=M.size,k=M.anchor,z=M.pixelDensity;u(f,X,Y,c,U,k,z,G,w,j),a(f)||o(g,X,f),u(s,X,Y,c,U,k,z,G,w,A),a(s)||o(I,X,s)}}for(var P=0;P<p.length;P++){var D=p[P],C=D.safeZone,_=D.iconIndex,j=D.margin,A=D.degradation,M=d[_];if(M){var U=M.size,k=M.anchor,z=M.pixelDensity;y.set(I);for(var R=0;R<l;R++){var Z=R*x.a,q=v[Z+x.b.groupIndex],h=v[Z+x.b.prevGroupIndex],G=v[Z+x.b.pixelPositionX],w=v[Z+x.b.pixelPositionY];q>P||!t(h)||(u(f,X,Y,c,U,k,z,G,w,j),a(f)||q===P&&i(y,X,f)||(u(m,X,Y,c,U,k,z,G,w,C),a(m)||i(g,X,m)||(u(s,X,Y,c,U,k,z,G,w,A),o(g,X,f),o(I,X,s),v[Z+x.b.iconIndex]=_,v[Z+x.b.prevGroupIndex]=P)))}}}postMessage(v)}}]);\n//# sourceMappingURL=6d0ff04c83ecb1dd4d04.worker.js.map',null)}}])});
//# sourceMappingURL=general.js.map